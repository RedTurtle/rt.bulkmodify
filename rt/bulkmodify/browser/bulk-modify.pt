<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:omit-tag=""
      metal:define-macro="controlpanel"
      i18n:domain="rt.bulkmodify">

<metal:block use-macro="context/prefs_main_template/macros/master">

<body>
<div metal:fill-slot="prefs_configlet_main">

        <div id="bulkModify">
        
			<script type="text/template" id="modelDataRow">
				<tr><td><input class="selectCommand" type="checkbox" name="textMatch" value="" /></td>
				<td class="matchDocument"></td>
				<td class="matchText"></td></tr>
			</script>
			<script type="text/template" id="modelDataRowNoResults">
				<tr><td colspan="3" class="noResults">No results found</td></tr>
			</script>
			<script type="text/template" id="modelModifySelectedButton">
				<input type="submit" class="allowMultiSubmit" id="modifySelected" name="modifySelected" value="Modify selected" />
			</script>
		
		    <script type="text/javascript" src="++resource++rt.bulkmodify.resources/bulk-modify.js"></script>
		    <link rel="stylesheet" type="text/css" media="screen"  href="++resource++rt.bulkmodify.resources/bulk-modify.css" />

            <a href=""
               id="setup-link"
               tal:attributes="href string:$portal_url/plone_control_panel"
               i18n:domain="plone"
               i18n:translate="">
                Site Setup
            </a> &rsaquo;

			<h1 class="documentFirstHeading">
				Bulk modify contents
			</h1>

			<dl class="portalMessage warning">
				<dt>Please note!</dt>
				<dd>
					Read carefully notes below.
				</dd>
			</dl>
			
			<p class="documentDescription">
				From this page you can perform a regex search inside your site contents.
				Every search you'll run will awake site contents, and this can be painfully slow, and
				slow down your site.<br/>
				Even worst: if you perform substitution using the &quot;Replace regex&quot; below you
				will perform a database write for every document you are chaging.<br />
				Be sure of what you are doing here.
			</p>


			<form id="bulkSearchForm" method="post" action=""
			      tal:define="DEFAULT_TYPES python:('Document', 'News Item', 'Event', 'Topic', 'Collection')"
			      tal:attributes="action string:${context/absolute_url}/@@batchSearch">
				<fieldset>
					<legend>Bulk modify</legend>
					
					<div class="field">
						<label for="content_type">Content types</label>
						<div class="formHelp">
							Select the set of content types to be inspected
						</div>
						
						<tal:types repeat="t view/type_vocabulary">
							<input type="checkbox" name="content_type:list" id="" value=""
							       tal:attributes="id string:type-${repeat/t/number};
								                   value t/value;
												   checked python:t.value in DEFAULT_TYPES;" />
							<label class="possibleContentType" for=""
							       tal:content="t/title"
								   tal:attributes="for string:type-${repeat/t/number};">Page</label>
						</tal:types>
					</div>

					<div class="field">
						<strong>Regex flags</strong>
						<div class="formHelp">
							Regex options
						</div>
						<span class="flag">
						<input type="checkbox" id="re-I" name="re-I" value="2" checked="checked" /> <label for="re-I">Ignore case</label>
						</span> 
						<span class="flag">
						<input type="checkbox" id="re-M" name="re-M" value="8" checked="checked" /> <label for="re-M">Multiline</label>
						</span> 
						<span class="flag">
						<input type="checkbox" id="re-S" name="re-S" value="16" /> <label for="re-S">Dot all</label>
						</span> 
						<span class="flag">
						<input type="checkbox" id="re-X" name="re-X" value="64" /> <label for="re-X">Verbose</label>
						</span> 

					</div>

					<div class="field">
						<label for="searchQuery">Search regex</label>
						<div class="formHelp">
							Type a regular expression for performing the search.
						</div>
						<textarea cols="80" rows="5" name="searchQuery" id="searchQuery"></textarea>
					</div>

					<div class="field">
						<label for="repltype-0">Replace text</label>
						<div class="formHelp">
							Select the kind of text replace you want to perform (if any)
						</div>
						<tal:repltypes repeat="t view/repl_type_vocabulary">
							<input type="radio" name="replace_type" id="" value=""
							       tal:attributes="id string:repltype-${repeat/t/index};
								                   value t/value;
												   checked python:t['value']=='';" />
							<label class="possibleReplaceType" for=""
							       tal:content="t/title"
								   tal:attributes="for string:repltype-${repeat/t/index};">Simple</label>
							<div class="formHelp" tal:content="t/description">
								How works the simple replacment
							</div>
						    <textarea cols="80" rows="5" name="replaceQuery" id="replaceQuery"
							          tal:condition="repeat/t/start"></textarea>
						</tal:repltypes>
					</div>
					
					<input type="submit" class="allowMultiSubmit" id="searchButton" name="Search" value="Search" />
					<input style="display:none" type="button" class="allowMultiSubmit" id="pauseButton" name="Pause" value="Pause" />
				</fieldset>
			
			</form>

			<div id="results" style="display:none">
				<form id="bulkModifyForm" method="post" action=""
			          tal:attributes="action string:${context/absolute_url}/@@bulk-modify">
					<fieldset>
						<legend>Bulk replace</legend>
					<table class="listing">
						<tr><th id="cellCommands"></th><th id="cellDocumentInfo">Document</th><th id="cellText">Text found</th></tr>
					</table>
					</fieldset>
				</form>
			</div>

		</div>

</div>
</body>

</metal:block>
</html>
